# FastestJSONInTheWest CMake Package Configuration Template
# Author: Olumuyiwa Oluwasanmi
# Generated configuration file for external projects using FastestJSONInTheWest

@PACKAGE_INIT@

# FastestJSONInTheWest Package Information
set(FastestJSONInTheWest_VERSION "@PROJECT_VERSION@")
set(FastestJSONInTheWest_VERSION_MAJOR "@PROJECT_VERSION_MAJOR@")
set(FastestJSONInTheWest_VERSION_MINOR "@PROJECT_VERSION_MINOR@")
set(FastestJSONInTheWest_VERSION_PATCH "@PROJECT_VERSION_PATCH@")

# Check if targets are already defined
if(NOT TARGET FastestJSONInTheWest::FastestJSONInTheWest)
    # Include the targets file
    include("${CMAKE_CURRENT_LIST_DIR}/FastestJSONInTheWestTargets.cmake")
endif()

# Check required components
set(_FastestJSONInTheWest_FIND_PARTS_REQUIRED)
if(FastestJSONInTheWest_FIND_REQUIRED)
    set(_FastestJSONInTheWest_FIND_PARTS_REQUIRED REQUIRED)
endif()
set(_FastestJSONInTheWest_FIND_PARTS_QUIET)
if(FastestJSONInTheWest_FIND_QUIETLY)
    set(_FastestJSONInTheWest_FIND_PARTS_QUIET QUIET)
endif()

# Handle components
set(_FastestJSONInTheWest_MISSING_COMPONENTS "")
foreach(_comp ${FastestJSONInTheWest_FIND_COMPONENTS})
    if(_comp STREQUAL "Core")
        # Core library is always available
        set(FastestJSONInTheWest_${_comp}_FOUND TRUE)
    elseif(_comp STREQUAL "Python")
        # Check if Python bindings are available
        if(TARGET FastestJSONInTheWest::fastjson_py)
            set(FastestJSONInTheWest_${_comp}_FOUND TRUE)
        else()
            set(FastestJSONInTheWest_${_comp}_FOUND FALSE)
            list(APPEND _FastestJSONInTheWest_MISSING_COMPONENTS ${_comp})
        endif()
    elseif(_comp STREQUAL "AgentComm")
        # Check if agent communication library is available
        if(TARGET FastestJSONInTheWest::FastJSON_AgentComm)
            set(FastestJSONInTheWest_${_comp}_FOUND TRUE)
        else()
            set(FastestJSONInTheWest_${_comp}_FOUND FALSE)
            list(APPEND _FastestJSONInTheWest_MISSING_COMPONENTS ${_comp})
        endif()
    else()
        set(FastestJSONInTheWest_${_comp}_FOUND FALSE)
        list(APPEND _FastestJSONInTheWest_MISSING_COMPONENTS ${_comp})
    endif()
endforeach()

# Report missing components
if(_FastestJSONInTheWest_MISSING_COMPONENTS)
    if(FastestJSONInTheWest_FIND_REQUIRED)
        message(FATAL_ERROR "Missing required FastestJSONInTheWest components: ${_FastestJSONInTheWest_MISSING_COMPONENTS}")
    elseif(NOT FastestJSONInTheWest_FIND_QUIETLY)
        message(WARNING "Missing FastestJSONInTheWest components: ${_FastestJSONInTheWest_MISSING_COMPONENTS}")
    endif()
endif()

# Set found status
set(FastestJSONInTheWest_FOUND TRUE)

# Set useful variables for users
get_target_property(FastestJSONInTheWest_INCLUDE_DIRS 
    FastestJSONInTheWest::FastestJSONInTheWest 
    INTERFACE_INCLUDE_DIRECTORIES
)

# Provide helper variables and functions
set(FastestJSONInTheWest_LIBRARIES FastestJSONInTheWest::FastestJSONInTheWest)

# Check for C++23 support
include(CheckCXXCompilerFlag)
check_cxx_compiler_flag("-std=c++23" _FastestJSONInTheWest_CXX23_SUPPORTED)
if(NOT _FastestJSONInTheWest_CXX23_SUPPORTED)
    if(FastestJSONInTheWest_FIND_REQUIRED)
        message(FATAL_ERROR "FastestJSONInTheWest requires C++23 support, but the compiler does not support it")
    elseif(NOT FastestJSONInTheWest_FIND_QUIETLY)
        message(WARNING "FastestJSONInTheWest requires C++23 support, but the compiler does not support it")
    endif()
    set(FastestJSONInTheWest_FOUND FALSE)
endif()

# Helper function to check if SIMD optimization is available
function(fastjson_check_simd_support)
    include(CheckIncludeFileCXX)
    check_include_file_cxx("immintrin.h" _FastestJSONInTheWest_HAVE_AVX)
    check_include_file_cxx("arm_neon.h" _FastestJSONInTheWest_HAVE_NEON)
    
    if(_FastestJSONInTheWest_HAVE_AVX)
        set(FastestJSONInTheWest_SIMD_SUPPORT "AVX" PARENT_SCOPE)
    elseif(_FastestJSONInTheWest_HAVE_NEON)
        set(FastestJSONInTheWest_SIMD_SUPPORT "NEON" PARENT_SCOPE)
    else()
        set(FastestJSONInTheWest_SIMD_SUPPORT "NONE" PARENT_SCOPE)
    endif()
endfunction()

# Print configuration information if not quiet
if(NOT FastestJSONInTheWest_FIND_QUIETLY)
    message(STATUS "Found FastestJSONInTheWest: ${FastestJSONInTheWest_VERSION}")
    message(STATUS "  Author: Olumuyiwa Oluwasanmi")
    message(STATUS "  Include dirs: ${FastestJSONInTheWest_INCLUDE_DIRS}")
    message(STATUS "  C++23 support: ${_FastestJSONInTheWest_CXX23_SUPPORTED}")
    
    # Show available components
    set(_components "Core")
    if(TARGET FastestJSONInTheWest::fastjson_py)
        list(APPEND _components "Python")
    endif()
    if(TARGET FastestJSONInTheWest::FastJSON_AgentComm)
        list(APPEND _components "AgentComm") 
    endif()
    message(STATUS "  Available components: ${_components}")
endif()

check_required_components(FastestJSONInTheWest)